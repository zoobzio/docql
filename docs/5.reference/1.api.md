---
title: API Reference
description: Complete API documentation
author: zoobzio
published: 2025-12-29
updated: 2025-12-29
tags:
  - Reference
  - API
---

# API Reference

Complete reference for the DOCQL package.

## Package Import

```go
import "github.com/zoobzio/docql"
import "github.com/zoobzio/docql/pkg/mongodb"
```

---

## Instance

### NewFromDDML

Creates a DOCQL instance from a DDML schema.

```go
func NewFromDDML(schema *ddml.Schema) (*DOCQL, error)
```

**Returns:** Instance bound to schema, or error if schema is invalid.

---

## Accessors

### C

Returns a validated collection reference.

```go
func (d *DOCQL) C(name string) Collection
```

**Panics:** If collection doesn't exist in schema.

### TryC

Returns a validated collection reference or error.

```go
func (d *DOCQL) TryC(name string) (Collection, error)
```

### F

Returns a validated field reference.

```go
func (d *DOCQL) F(collection, path string) Field
```

**Panics:** If field doesn't exist in collection.

### TryF

Returns a validated field reference or error.

```go
func (d *DOCQL) TryF(collection, path string) (Field, error)
```

### P

Returns a validated parameter reference.

```go
func (d *DOCQL) P(name string) Param
```

**Panics:** If parameter name is invalid.

### TryP

Returns a validated parameter reference or error.

```go
func (d *DOCQL) TryP(name string) (Param, error)
```

---

## Query Starters

### Find

Creates a find query for multiple documents.

```go
func Find(c Collection) *Builder
```

### FindOne

Creates a find query for a single document.

```go
func FindOne(c Collection) *Builder
```

### Insert

Creates an insert query for a single document.

```go
func Insert(c Collection) *Builder
```

### InsertMany

Creates an insert query for multiple documents.

```go
func InsertMany(c Collection) *Builder
```

### Update

Creates an update query for a single document.

```go
func Update(c Collection) *Builder
```

### UpdateMany

Creates an update query for multiple documents.

```go
func UpdateMany(c Collection) *Builder
```

### Delete

Creates a delete query for a single document.

```go
func Delete(c Collection) *Builder
```

### DeleteMany

Creates a delete query for multiple documents.

```go
func DeleteMany(c Collection) *Builder
```

### Count

Creates a count query.

```go
func Count(c Collection) *Builder
```

### Distinct

Creates a distinct values query.

```go
func Distinct(c Collection, field Field) *Builder
```

### Aggregate

Creates an aggregation pipeline.

```go
func Aggregate(c Collection) *Builder
```

---

## Builder Methods

### Filter / Where

Adds a filter condition.

```go
func (b *Builder) Filter(f FilterItem) *Builder
func (b *Builder) Where(f FilterItem) *Builder  // Alias
```

### Select

Specifies fields to include in results.

```go
func (b *Builder) Select(fields ...Field) *Builder
```

### Exclude

Specifies fields to exclude from results.

```go
func (b *Builder) Exclude(fields ...Field) *Builder
```

### Sort

Adds a sort clause.

```go
func (b *Builder) Sort(field Field, order SortOrder) *Builder
```

### SortAsc

Adds ascending sort.

```go
func (b *Builder) SortAsc(field Field) *Builder
```

### SortDesc

Adds descending sort.

```go
func (b *Builder) SortDesc(field Field) *Builder
```

### Skip

Sets the number of documents to skip.

```go
func (b *Builder) Skip(n int) *Builder
```

### SkipParam

Sets the number of documents to skip from a parameter.

```go
func (b *Builder) SkipParam(p Param) *Builder
```

### Limit

Sets the maximum number of documents to return.

```go
func (b *Builder) Limit(n int) *Builder
```

### LimitParam

Sets the maximum number of documents from a parameter.

```go
func (b *Builder) LimitParam(p Param) *Builder
```

### Document

Sets the document for insert operations.

```go
func (b *Builder) Document(doc Document) *Builder
```

### Documents

Sets multiple documents for insert operations.

```go
func (b *Builder) Documents(docs []Document) *Builder
```

### Set

Adds a $set update operation.

```go
func (b *Builder) Set(field Field, value Param) *Builder
```

### Inc

Adds a $inc update operation.

```go
func (b *Builder) Inc(field Field, value Param) *Builder
```

### Unset

Adds a $unset update operation.

```go
func (b *Builder) Unset(fields ...Field) *Builder
```

### Push

Adds a $push update operation.

```go
func (b *Builder) Push(field Field, value Param) *Builder
```

### Pull

Adds a $pull update operation.

```go
func (b *Builder) Pull(field Field, value Param) *Builder
```

### AddToSet

Adds a $addToSet update operation.

```go
func (b *Builder) AddToSet(field Field, value Param) *Builder
```

### Upsert

Enables upsert mode for update operations.

```go
func (b *Builder) Upsert() *Builder
```

---

## Aggregation Methods

### Match

Adds a $match stage to filter documents.

```go
func (b *Builder) Match(filter FilterItem) *Builder
```

### Group

Adds a $group stage.

```go
func (b *Builder) Group(id Expression, accumulators map[string]Accumulator) *Builder
```

### Project

Adds a $project stage.

```go
func (b *Builder) Project(proj Projection) *Builder
```

### Unwind

Adds an $unwind stage.

```go
func (b *Builder) Unwind(field Field) *Builder
```

### Lookup

Adds a $lookup stage for joining collections.

```go
func (b *Builder) Lookup(from string, localField, foreignField Field, as string) *Builder
```

### Stage

Adds a custom pipeline stage.

```go
func (b *Builder) Stage(stage PipelineStage) *Builder
```

---

## Document Builder

### Doc

Creates a document builder for insert operations.

```go
func Doc() *DocumentBuilder
```

### DocumentBuilder.Set

Sets a field value in the document.

```go
func (d *DocumentBuilder) Set(field Field, value Param) *DocumentBuilder
```

### DocumentBuilder.Build

Returns the built document.

```go
func (d *DocumentBuilder) Build() Document
```

---

## Rendering

### Render

Renders the query using the specified provider.

```go
func (b *Builder) Render(r Renderer) (*QueryResult, error)
```

### MustRender

Renders the query, panicking on error.

```go
func (b *Builder) MustRender(r Renderer) *QueryResult
```

### Build

Returns the internal AST.

```go
func (b *Builder) Build() (*DocumentAST, error)
```

### MustBuild

Returns the internal AST, panicking on error.

```go
func (b *Builder) MustBuild() *DocumentAST
```

---

## Filter Constructors

### Comparison

```go
func (d *DOCQL) Eq(field Field, value Param) FilterItem
func (d *DOCQL) Ne(field Field, value Param) FilterItem
func (d *DOCQL) Gt(field Field, value Param) FilterItem
func (d *DOCQL) Gte(field Field, value Param) FilterItem
func (d *DOCQL) Lt(field Field, value Param) FilterItem
func (d *DOCQL) Lte(field Field, value Param) FilterItem
```

### Set Membership

```go
func (d *DOCQL) In(field Field, value Param) FilterItem
func (d *DOCQL) Nin(field Field, value Param) FilterItem
```

### Logical

```go
func (d *DOCQL) And(conditions ...FilterItem) FilterItem
func (d *DOCQL) Or(conditions ...FilterItem) FilterItem
func (d *DOCQL) Nor(conditions ...FilterItem) FilterItem
```

### Package-Level Filters

```go
func Exists(field Field) FilterItem
func NotExists(field Field) FilterItem
func Range(field Field, min, max *Param) FilterItem
func RangeExclusive(field Field, min, max *Param) FilterItem
func Regex(field Field, pattern Param) FilterItem
func RegexWithOptions(field Field, pattern, options Param) FilterItem
func TextSearch(term Param) FilterItem
func All(field Field, values Param) FilterItem
func Size(field Field, size Param) FilterItem
func ElemMatch(field Field, conditions ...FilterItem) FilterItem
func Geo(field Field, lon, lat, maxDistance Param) FilterItem
```

---

## Expression Constructors

```go
func FieldExpr(field Field) Expression
func LiteralExpr(value Param) Expression
```

---

## Accumulator Constructors

```go
func Sum(expr Expression) Accumulator
func Avg(expr Expression) Accumulator
func Min(expr Expression) Accumulator
func Max(expr Expression) Accumulator
func First(expr Expression) Accumulator
func Last(expr Expression) Accumulator
func CountAcc() Accumulator
```

---

## Types

### QueryResult

Result from rendering a query.

```go
type QueryResult struct {
    JSON           string   // Rendered query as JSON
    RequiredParams []string // Parameters that must be provided
}
```

### SortOrder

Sort direction constant.

```go
type SortOrder int

const (
    Ascending  SortOrder = 1
    Descending SortOrder = -1
)
```

### Operation

Query operation type.

```go
type Operation string

const (
    OpFind       Operation = "FIND"
    OpFindOne    Operation = "FIND_ONE"
    OpInsert     Operation = "INSERT"
    OpInsertMany Operation = "INSERT_MANY"
    OpUpdate     Operation = "UPDATE"
    OpUpdateMany Operation = "UPDATE_MANY"
    OpDelete     Operation = "DELETE"
    OpDeleteMany Operation = "DELETE_MANY"
    OpAggregate  Operation = "AGGREGATE"
    OpCount      Operation = "COUNT"
    OpDistinct   Operation = "DISTINCT"
)
```

---

## Renderer Interface

```go
type Renderer interface {
    Render(ast *DocumentAST) (*QueryResult, error)
    SupportsOperation(op Operation) bool
    SupportsFilter(op FilterOperator) bool
    SupportsUpdate(op UpdateOperator) bool
    SupportsPipelineStage(stage string) bool
}
```

---

## Providers

### MongoDB

```go
import "github.com/zoobzio/docql/pkg/mongodb"

renderer := mongodb.New()
```

### DynamoDB

```go
import "github.com/zoobzio/docql/pkg/dynamodb"

renderer := dynamodb.New()
```

### Firestore

```go
import "github.com/zoobzio/docql/pkg/firestore"

renderer := firestore.New()
```

### CouchDB

```go
import "github.com/zoobzio/docql/pkg/couchdb"

renderer := couchdb.New()
```
